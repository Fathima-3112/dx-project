<template>
    <lightning-card>
        <lightning-spinner if:true={isLoading} alternative-text="Loading" size="medium"></lightning-spinner>

        <template if:false={isLoading}>
        <template if:true={showBanner}>
    <!--div class="slds-box slds-m-around_medium" -->
    <h3 class="slds-text-heading_small slds-text-align_center slds-p-around_medium">{subRequestType}</h3>
    <div class="sku-banner slds-box slds-theme_alert-texture slds-m-bottom_medium" 
    style="background-color: #fef7e0; border: 1px solid #f2c200; border-radius: 6px;
    padding: 10px; margin-bottom: 10px; font-weight: 500; color: #5a5a5a; text-align: center;">
    <strong>Note:</strong> File upload will appear only after the case is created. So, Please select the option YES and click the "Create Case" button to proceed.
    </div>
</template>

<template if:true={showBannerForSRTR}>
    <h3 class="slds-text-heading_small slds-text-align_center slds-p-around_medium">{subRequestType}</h3>
    <div class="sku-banner slds-box slds-theme_alert-texture slds-m-bottom_medium" 
    style="background-color: #fef7e0; border: 1px solid #f2c200; border-radius: 6px;
    padding: 10px; margin-bottom: 10px; font-weight: 500; color: #5a5a5a; text-align: center;">
    <strong>Note:</strong> File upload will appear only after the case is created. So, Please select the option YES and click the "Create Case" button to proceed.
    <br><br>
    <strong> ADDITIONAL INSTRUCTIONS:</strong>This form is to be used for all items that are sent back to your hub. All items going on a reverse must have two or more tags taped to the outside of the box or other packaging material. This is needed to identify where an item should go once received at the local hub. Please fill out the form completely including any damages to simplify the movement of the product.

    </div>
</template>


<!-- Status Change -->
<template if:true={showTwilight}>
                                        
    <div class="slds-grid slds-wrap slds-p-around_medium">
        <div class="slds-col slds-size_1-of-3 slds-p-right_small"> <lightning-record-picker label="Location Impacted"  placeholder="Type Something..." object-api-name="Store__c"  onchange={handleHubLocationChange}  name="hubLocation" value={hubLocationId} required ></lightning-record-picker></div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-textarea label="Additional Notes free entry window" onchange={handleInputChange}  name="additionalNotes" class="slds-m-top_small"></lightning-textarea></div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-radio-group label="Will you attach files for this request?" options={fileAttachmentOptions} name="willAttachFiles"  value={willAttachFiles}  onchange={handleFileAttachmentChange} class="slds-m-bottom_medium" required ></lightning-radio-group></div>
    </div>
    </template>
    
    <!-- Physical Inventory -->
     <template if:true={showPhysicalInv}>
    <div class="slds-grid slds-wrap slds-p-around_medium slds-gutters">
        <div class="slds-col slds-size_1-of-2 slds-p-right_small"> <lightning-input  type="date" name="swatchAuditDate"  label="Date of PI, CC or Swatch Audit"  onchange={handleInputChange}  required  class="slds-m-top_x-small">  </lightning-input></div>
        <div class="slds-col slds-size_1-of-2 slds-p-left_small"> <lightning-textarea  label="Additional Notes free entry window"  onchange={handleInputChange}  name="additionalNotes" class="slds-m-top_x-small"> </lightning-textarea> </div>
        <div class="slds-col slds-size_1-of-2 slds-p-right_small"><lightning-record-picker label="Location Impacted" placeholder="Type Something..." object-api-name="Store__c"  onchange={handleHubLocationChange} name="hubLocation"  value={hubLocationId} required ></lightning-record-picker> </div>
        <div class="slds-col slds-size_1-of-2 slds-p-left_small"><lightning-radio-group label="Will you attach files for this request?" name="willAttachFiles"  options={fileAttachmentOptions} value={willAttachFiles} onchange={handleFileAttachmentChange} class="slds-m-bottom_medium" required ></lightning-radio-group></div>
    </div>
    </template>
    
    <!-- Store Reverse Transfer Request -->
     <template if:true={showStoreReverse}>
    <div class="slds-grid slds-wrap slds-p-around_medium slds-gutters">
        <div class="slds-col slds-size_1-of-4 slds-p-right_small"> <lightning-input type="date" name="reversePickupDate" label="Reverse pickup date" onchange={handleInputChange} required class="slds-m-top_x-small"> </lightning-input> </div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small"> <lightning-record-picker label="Store" placeholder="Type Something..." object-api-name="Store__c" onchange={handleHubLocationChange} name="hubLocation"  value={hubLocationId}  required ></lightning-record-picker></div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small"> <lightning-input label="Approval" name="approval" onchange={handleInputChange} required> </lightning-input></div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small"><lightning-radio-group  label="Same Day reverse request"   name="sameDayReverseRequest" onchange={handleInputChange} options={fileAttachmentOptions}  required  type="radio"> </lightning-radio-group></div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small"><lightning-radio-group  label="Have you verified these items are not in Twilight status"   name="haveYouVerified" onchange={handleInputChange} options={SRTRTwilight}  required  type="radio"> </lightning-radio-group></div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small"> <lightning-radio-group label="Will you attach photos for this request?(Photos are required to be attached to the request only in cases where items will be disposed of at the hub)" name="willAttachFiles"  options={fileAttachmentOptions} value={willAttachFiles} onchange={handleFileAttachmentChange} class="slds-m-bottom_medium" required ></lightning-radio-group></div>
        <div class="slds-col slds-size_1-of-4 slds-p-left_small">
            <div class="slds-m-around_x-small"><lightning-combobox class="field" name="numberOfSKUs" label="Number of SKUs to be entered" value={numberOfSKUs} options={skuNumberOptions} onchange={handleSkuNumberChange} required></lightning-combobox></div>
        </div>   
    </div>
    <template for:each={skuFields} for:item="sku">
        <div key={sku.index} class="slds-align_absolute-center">
            <div class="slds-size_1-of-5">
                <div class="slds-m-around_x-small"><lightning-input class="field" label="SKU" data-index={sku.index} value={sku.sku} onchange={handleSkuChange} required></lightning-input></div>
            </div>
            <div class="slds-size_1-of-5">
                <div class="slds-m-around_x-small"><lightning-input class="field" label="Quantity" data-index={sku.index} value={sku.quantity} onchange={handleQuantityChange} required></lightning-input></div>       
            </div>
            <div class="slds-size_1-of-5">
                <div class="slds-m-around_x-small"><lightning-input class="field" label="Sku Description" data-index={sku.index} value={sku.skuDescription} onchange={handleSkuDescriptionChange}  required></lightning-input></div>
            </div>
            <div class="slds-size_1-of-5">
                <div class="slds-m-around_x-small"><lightning-combobox label="Reason"   name="reasonForSRTR" data-index={sku.index} options={srtrReasons} onchange={handleReasonChange} value={sku.reasonSRTR} required> </lightning-combobox></div>
            </div>
            <template if:true={sku.showOtherInput}>
                <div class="slds-col slds-size_1-of-5 slds-p-left_small">  <lightning-input  name="other"  label="Others(Please provide reason)"  data-index={sku.index} value={sku.otherValue} onchange={handleOtherInputChange}    required class="slds-m-top_x-small"> </lightning-input></div>
            </template> 
        </div>
    </template> 
    </template>
    
    <!-- AS-IS to Saleable -->
    <template if:true={showASIS}>
    <div class="slds-grid slds-wrap slds-p-around_medium slds-gutters">
        <div class="slds-col slds-size_1-of-3 slds-p-right_small"> <lightning-record-picker label="Location Impacted"  placeholder="Type Something..."  object-api-name="Store__c" onchange={handleHubLocationChange} name="hubLocation" value={hubLocationId}  required ></lightning-record-picker> </div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"> <lightning-input   name="skuCollection"  label="SKU/Collections" onchange={handleInputChange}  required class="slds-m-top_x-small"> </lightning-input> </div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-radio-group label="Will you attach files for this request?" name="willAttachFiles"  options={fileAttachmentOptions}  value={willAttachFiles} onchange={handleFileAttachmentChange} class="slds-m-bottom_medium" required ></lightning-radio-group></div>
    </div>
    </template>
    
    <!-- Add or remove items from store inventory -->
    <template if:true={showAddOrRemove}>
    <div class="slds-grid slds-wrap slds-p-around_medium slds-gutters">
        <div class="slds-col slds-size_1-of-3 slds-p-right_small"><lightning-record-picker label="Location Impacted" placeholder="Type Something..."  object-api-name="Store__c" onchange={handleHubLocationChange} name="hubLocation" value={hubLocationId}  required></lightning-record-picker></div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-input  label="SKU"  name="skuCollection"  onchange={handleInputChange}  required> </lightning-input> </div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-textarea  label="Additional Notes Free Entry Window"  name="additionalNotes"  onchange={handleInputChange}> </lightning-textarea></div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-input  label="Quantity"  name="skuQuantity" onchange={handleInputChange} required></lightning-input></div>
        <div class="slds-col slds-size_1-of-3 slds-p-left_small"><lightning-radio-group  type="radio" label="Will you attach files for this request?" options={fileAttachmentOptions}  name="willAttachFiles" value={willAttachFiles} onchange={handleFileAttachmentChange} required> </lightning-radio-group> </div>
    </div>        
    </template>

    
<!-- Button to create case -->
<template if:true={showButton}>
 <div class="slds-col slds-align_absolute-center slds-size_1-of-1 slds-p-top_medium" style="height:5rem">
    <lightning-button label="Create Case"  onclick={handleCreateCase}  variant="brand"  class="slds-m-top_medium"></lightning-button>
 </div>
</template>

<!-- Modal for File Upload (Auto-opened after case creation if 'Yes') -->
<template if:true={isModalOpen}>
<section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
        <div class="slds-modal__container">
            <header class="slds-modal__header">
                <h2 class="slds-text-heading_medium">Upload Files</h2>
            </header>

    <div class="slds-modal__content slds-p-around_medium">
    <template if:true={relatedRecordBool}>
        <lightning-file-upload label="Attach Files" name="UploadFile"  record-id={relatedRecordId}  onuploadfinished={handleUploadFinished} multiple file-field-name="Guest_Record_fileupload__c"  file-field-value={relatedRecordId}> </lightning-file-upload>
    </template>
    </div>

    <footer class="slds-modal__footer">
        <lightning-button variant="neutral" label="Close" onclick={closeModal}></lightning-button>
    </footer>
    </div>
</section>
<div class="slds-backdrop slds-backdrop_open"></div>
</template>
</template>
</lightning-card>
</template>